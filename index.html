<!DOCTYPE html>
<html>
  <head>
    <title>STRAVA MCR</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  </head>
  <body>
    <h1>Strava Monthly Club Report</h1>
    <form action="/api" method="post" enctype="multipart/form-data">
      <label for="file">File</label>
      <input id="file" name="file" type="file" />
      <script>
        function readSingleFile(evt) {
          var f = evt.target.files[0];
          if (f) {
            var r = new FileReader();
            r.onload = function (e) {
              var contents = e.target.result;
              document.write(
                "File Uploaded! <br />" +
                  "name: " +
                  f.name +
                  "<br />" +
                  "content: " +
                  contents +
                  "<br />" +
                  "type: " +
                  f.type +
                  "<br />" +
                  "size: " +
                  f.size +
                  " bytes <br />"
              );

              var lines = contents.split("\n"),
                output = [];
              for (var i = 0; i < lines.length; i++) {
                output.push(
                  "<tr><td>" +
                    lines[i].split(",").join("</td><td>") +
                    "</td></tr>"
                );
              }
              output = "<table>" + output.join("") + "</table>";
              document.write(output);
            };
            r.readAsText(f);
            document.write(output);
          } else {
            alert("Failed to load file");
          }
        }
        document
          .getElementById("fileinput")
          .addEventListener("change", readSingleFile);
      </script>
      <button>Upload</button>
    </form>
  </body>
</html>
